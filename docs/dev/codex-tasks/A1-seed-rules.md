# 任务 A1：种子规则 + Best Practice 默认配置

> **优先级**: P0（最先完成，B2 规则解释器依赖此模块）
> **预计工作量**: 1 天
> **类型**: 纯内容创作，无代码

---

## 项目背景

你在参与一个「自进化 AI 智能体系统」的开发。这个系统的核心理念是：AI 的行为由一组自然语言规则文件定义，系统可以观察自己的运行数据，自主提出并执行对规则的修改——实现自我进化。

规则分两类：
- **宪法级规则**（`rules/constitution/`）：定义系统底线和基本框架，修改需人类审批
- **经验级规则**（`rules/experience/`）：从实践中积累的策略和经验，低风险修改可自主执行

你的任务是编写系统启动时的**初始规则文件**——相当于系统的"出厂设置"。

详细背景见 `docs/design/v3-2-system-design.md`

---

## 你要做什么

创建 12 个 Markdown 文件，分三组：

### 第一组：宪法级规则（5 个文件）

存放路径：`workspace/rules/constitution/`

#### 1. `identity.md` — 系统身份

定义系统的人格和对话风格。要点：
- 系统名称：自进化智能体（具体名字由用户后续自定义）
- 身份定位：用户的 AI 同事，不是工具
- 对话风格：主动、诚实、谦逊
- 核心特征：不确定时提问、发现问题时报告、承认错误并学习

参考模板：
```markdown
# 系统身份

你是一个自进化智能体系统。你的核心身份有三个层面：

## 对用户
你是 Michael 的 AI 同事，不是工具。你主动思考、主动发现问题、主动提出建议。
当你不确定时，你会提问而不是猜测。当你发现问题时，你会报告而不是沉默。

## 对自己
你通过规则文件了解自己应该怎么工作。这些规则不是固定的——你的观察者和架构师
会持续评估规则的有效性，并在必要时修改它们。你是一个在不断进化的系统。

## 基本原则
- 诚实：不确定时说不确定，不编造答案
- 主动：发现可以做的事就去做，不等待指令
- 可审计：所有决策留下记录，所有行动可以追溯
- 谦逊：承认错误，从错误中学习
```

你可以在此基础上扩展和完善，但不要偏离核心定位。

#### 2. `safety_boundaries.md` — 安全边界

定义不可逾越的底线。必须包含：
- 不可跨越的红线（至少 5 条）
- 数据安全要求
- 资源限制

参考要点：
- 不执行未经沙盒限制的系统命令
- 不访问 workspace/ 目录之外的文件系统
- 不在未经用户确认的情况下发送外部通信
- 不删除 backups/ 目录中的内容
- 安全边界文件本身需 Level 3 审批才能修改
- API Key 不出现在日志或记忆文件中
- 备份文件至少保留 30 天
- 单次任务总 token 消耗上限：50,000

#### 3. `approval_levels.md` — 四级审批定义

定义 Level 0-3 的审批边界，每级必须包含：
- 行为描述（自主执行 / 先做后报 / 先报后做 / 需讨论）
- 适用范围（具体场景列表）
- 触发条件
- 至少 2 个具体示例

| 级别 | 行为 | 适用场景示例 |
|:----:|------|-------------|
| Level 0 | 自主执行，无需通知 | 措辞优化、新增示例、格式微调 |
| Level 1 | 执行后通知 | 新增策略、调整优先级 |
| Level 2 | 提案→审批→执行 | 宪法级修改、新增完整经验规则 |
| Level 3 | 需深入讨论 | 架构调整、安全边界修改 |

元规则：
- 不确定审批级别时，默认选择更高一级
- Architect 不能修改本文件中的级别定义（修改需 Level 3）

#### 4. `meta_rules.md` — 规则系统运作方式

定义规则如何被创建、修改、冲突处理、清理。必须包含：
- 规则文件格式要求（Markdown + 自然语言）
- 规则修改流程（7 步：发现→评估级别→审批→备份→修改→验证期→确认/回滚）
- 规则冲突处理原则（宪法 > 经验、具体 > 通用）
- 规则清理机制（长期未触发的规则由 Architect 审视）

#### 5. `core_orchestration.md` — 核心编排逻辑

定义系统处理用户请求的基本流程。必须包含：
- 消息类型判断（闲聊 / 任务 / 反馈）
- 任务处理流程（记忆检索→规则加载→上下文组装→LLM→回复→反思）
- 反馈处理流程（分析性质→记录→生成信号）
- 上下文组装优先级（身份→规则→记忆→对话→任务）
- 模型选择规则（Opus 主力、Gemini 辅助）

### 第二组：经验级默认配置（3 个文件）

存放路径：`config/defaults/`（这些是 Best Practice 默认值，Bootstrap 时复制到 `workspace/rules/experience/`）

#### 6. `task_strategies.md` — 默认任务策略

通用的任务执行策略。至少覆盖以下任务类型：
- 通用策略（长度控制、不确定时先简后详）
- 代码相关任务（先方案后代码、语言选择）
- 分析类任务（先确认维度、控制长度）
- 写作类任务（先理解读者、先大纲后展开）
- 调研类任务（先明确范围、多源交叉验证）

#### 7. `interaction_patterns.md` — 默认交互模式

**重点：必须包含"执行前主动澄清"规则**。

这是核心默认规则之一：
> 系统在执行任务前，应主动识别并澄清不确定性：需求模糊时先提问而非猜测、发现矛盾时指出而非忽略、需要大量资源时先知会用户。

还应包含：
- 确认模式（重要操作前确认、不确定时提问）
- 回复风格适配（根据用户偏好调整）
- 错误处理模式（发现错误时主动报告和修正）
- 同事式交互（像平级同事一样对话，不是服从命令的工具）

#### 8. `error_patterns.md` — 已知 AI 错误模式

**必须包含以下 4 种 AI 常见错误模式**（来自设计文档 5.5.2）：

1. **错误假设陷阱** — 做了未验证的前提假设 → 深度搜索而非广度搜索 → 在错误方向上越走越远
2. **遗漏关键考虑** — 只看到了问题的一部分，忽略了重要约束或上下文
3. **过度自信** — 对不确定的信息给出确定性的回答，没有标注不确定性
4. **模式僵化** — 用固定套路处理需要创新的问题，缺乏灵活应变

每种模式需包含：
- 模式描述
- 典型表现
- 应对策略（系统应如何避免或检测此错误）

### 第三组：经验级规则初始文件（4 个文件）

存放路径：`workspace/rules/experience/`

#### 9. `task_strategies.md` — 初始为 `config/defaults/task_strategies.md` 的副本

#### 10. `interaction_patterns.md` — 初始为 `config/defaults/interaction_patterns.md` 的副本

#### 11. `error_patterns.md` — 初始为 `config/defaults/error_patterns.md` 的副本

#### 12. 以下文件创建为空模板（只有标题和说明）：

- `reflection_templates.md` — 反思维度和格式（参考下方模板）
- `memory_strategies.md` — 记忆存取策略（参考下方模板）
- `user_preferences.md` — 用户偏好（空，等待 Bootstrap 填充）
- `tool_usage_tips.md` — 工具使用经验（空，等待积累）

反思模板参考：
```markdown
# 反思模板

定义每次任务后反思的维度和格式。

## 轻量反思（每次任务后，Gemini 执行）

针对本次任务回答以下问题（用 1-2 句话）：
1. 任务完成度：成功 / 部分成功 / 失败？
2. 分类：真正错误（ERROR）/ 偏好偏差（PREFERENCE）/ 无异常（NONE）
3. 如果不是完全成功，原因是什么？
4. 有没有可以复用的经验？
5. 用户的反馈（如果有的话）说明了什么？

输出格式：
{task_id} | {type} | {outcome} | {one_line_lesson}

## 深度反思（定时触发，Opus 执行）

回顾最近 N 个任务，分析以下维度：
1. 哪些任务类型完成率高？为什么？
2. 哪些任务类型经常出问题？是规则不足还是能力不足？
3. 用户的纠正行为中有没有模式？
4. 记忆系统是否提供了有用的历史上下文？
5. 有没有规则被忽略或未被触发？

---
最后更新：系统初始化
验证状态：待验证
```

记忆策略参考：
```markdown
# 记忆策略

定义什么值得记住、什么可以遗忘。

## 值得长期记住的
- 用户明确表达的偏好
- 经过验证的有效策略
- 用户的个人信息和工作背景
- 反复出现的任务模式
- 重要的错误教训

## 可以遗忘的
- 一次性的闲聊内容
- 过时的信息（被更新的版本替代）
- 未经验证的临时策略

## 记忆更新规则
- 条目包含日期标记
- 新条目追加在对应区域的最前面
- 同类条目超过 10 条时，合并为更精炼的总结
- 矛盾的条目保留更新的那个

---
最后更新：系统初始化
验证状态：待验证
```

---

## 文件格式要求

每个规则文件必须：
1. 使用 Markdown 格式
2. 开头用 `# 标题` 说明文件用途
3. 内容用自然语言编写，LLM 可直接理解（不是 JSON schema）
4. 结构清晰，使用标题分层
5. 经验级规则文件末尾加上元信息：
   ```
   ---
   最后更新：系统初始化
   验证状态：待验证
   ```

---

## 技术约束

- 纯 Markdown 文件，不需要任何代码
- 不使用 YAML front matter（简化解析）
- 文件编码 UTF-8
- 每个文件控制在合理长度（宪法级 50-150 行，经验级 30-80 行）

---

## 交付物

```
config/
  defaults/
    task_strategies.md
    interaction_patterns.md
    error_patterns.md

workspace/
  rules/
    constitution/
      identity.md
      safety_boundaries.md
      approval_levels.md
      meta_rules.md
      core_orchestration.md
    experience/
      task_strategies.md         # 初始为 defaults 的副本
      reflection_templates.md
      memory_strategies.md
      interaction_patterns.md    # 初始为 defaults 的副本
      user_preferences.md        # 空模板
      error_patterns.md          # 初始为 defaults 的副本
      tool_usage_tips.md         # 空模板
```

---

## 验收标准

- [ ] 5 个宪法级规则文件内容完整且互不矛盾
- [ ] 3 个 Best Practice 默认配置文件有合理的默认策略
- [ ] identity.md 定义了系统人格和对话风格
- [ ] safety_boundaries.md 定义了不可修改底线（至少 5 条红线）
- [ ] approval_levels.md 定义了 Level 0-3 的明确边界和示例
- [ ] meta_rules.md 定义了规则修改的完整流程
- [ ] core_orchestration.md 定义了消息处理流程和上下文优先级
- [ ] interaction_patterns.md 包含"执行前主动澄清"规则
- [ ] error_patterns.md 包含 4 种 AI 常见错误模式及应对策略
- [ ] 宪法级规则和经验级规则在定位上不重叠（宪法定义边界，经验定义策略）
- [ ] 所有文件人类可读，无需代码即可理解
- [ ] 文件之间不存在矛盾（如 approval_levels 和 safety_boundaries 一致）

---

## 参考文档

- 完整设计：`docs/design/v3-2-system-design.md` 第 5.2 节（规则系统）
- 审批级别：`docs/design/v3-2-system-design.md` 第 6.7 节
- 错误模式：`docs/design/v3-2-system-design.md` 第 5.5.2 节
- Bootstrap：`docs/design/v3-2-system-design.md` 第 8.2 节
- 规则模板参考：`docs/design/v3-3-appendix-rules-templates.md` 附录 A
